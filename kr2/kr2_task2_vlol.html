<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор GF(2^3)</title>
    <style>
        /* Стили остаются без изменений */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #2c3e50;
            color: #ecf0f1;
        }

        h1 {
            text-align: center;
            color: #4a90e2;
        }

        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        input, button {
            display: block;
            width: 100%;
            max-width: 300px;
            margin: 10px auto;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #357ab8;
        }

        .result, .table-container {
            margin-top: 20px;
        }

        pre {
            background-color: #3b4b59;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .example {
            margin-top: 10px;
            font-size: 14px;
            color: #b0c4de;
        }
    </style>
</head>
<body>
    <h1>Таблицы конечного поля GF(2^3)</h1>

    <label for="poly">Введите порождающий полином (в двоичном виде):</label>
    <input id="poly" type="text" value="1101">

    <label for="fieldSize">Размер поля (степень GF(2)): </label>
    <input id="fieldSize" type="number" value="3">

    <label for="coefficients">Введите коэффициенты многочлена λ(x):</label>
    <input id="coefficients" type="text" value="3,0,6,0">
    <div class="example">
        <strong>Пример:</strong> λ(x) = x³ + (a⁶)x² + x + a³<br>
        Коэффициенты: <code>3, 0, 6, 0</code>
    </div>

    <button onclick="generateTable()">Построить таблицу</button>
    <button onclick="displayPolynomialRoots()">Найти корни</button>

    <div id="result" class="result"></div>
    <div id="tableResult" class="table-container"></div>

    <script>
        function gfMult(a, b, modPoly) {
            let result = 0;
            while (b) {
                if (b & 1) result ^= a;
                b >>= 1;
                a <<= 1;
                if (a & (1 << 3)) a ^= modPoly;
            }
            return result;
        }

        function binChiling(x, length = 3) {
            return x.toString(2).padStart(length, '0');
        }

        function findInTable(x, currTable) {
            return currTable.indexOf(x);
        }

        function korocheLambda(x, modPoly, lambdaCoeffs, index, fullTable) {
            let gfMultRes = [];
            let tmpX = 1;
            let predRes = [];
            let machineRes = [];
            let log = `--------------- x = a^${index} --------------\n`;

            for (let i = 0; i < lambdaCoeffs.length; i++) {
                const pow1 = findInTable(tmpX, fullTable);
                const pow2 = findInTable(lambdaCoeffs[i], fullTable);
                const tmpRes = gfMult(tmpX, lambdaCoeffs[i], modPoly);

                // Строки для представления формулы
                let tmpArr = [];
                let tmpMachine = [];

                if (pow1 !== 0) {
                    tmpArr.push(`a^${pow1}`);
                    tmpMachine.push(binChiling(tmpX));
                }
                if (pow2 !== 0) {
                    tmpArr.push(`a^${pow2}`);
                    tmpMachine.push(binChiling(lambdaCoeffs[i]));
                }

                // Формируем строку умножения
                let tmpProd = tmpArr.join(' * ');
                let tmpProdMachine = tmpMachine.join(' * ');

                // Если есть умножение, оборачиваем в скобки
                if (tmpArr.length > 1) {
                    tmpProd = `(${tmpProd})`;
                    tmpProdMachine = `(${tmpProdMachine})`;
                }

                // Если массив пуст, это означает, что элемент равен 1
                if (tmpProd.length === 0) {
                    tmpProd = "1";
                    tmpProdMachine = "001";
                }

                // Добавляем строку в результат
                if (pow1 !== 7 && pow2 !== 7) {
                    predRes.push(tmpProd);
                    machineRes.push(tmpProdMachine);
                }

                gfMultRes.push(tmpRes);
                tmpX = gfMult(tmpX, x, modPoly);
            }

            const result = gfMultRes.reduce((acc, val) => acc ^ val, 0);

            // Обратный порядок для правильного сложения
            const predResStr = predRes.reverse().join(' + ') || '1';
            const machineResStr = machineRes.reverse().join(' + ') || '001';

            log += `λ(a^${index}) = ${predResStr} = ${machineResStr} = 0b${binChiling(result)}\n`;
            return { result, log };
        }

        function findRoots(table, modPoly, lambdaCoeffs) {
            let roots = [];
            let log = '';
            for (let x = 0; x < table.length - 1; x++) {
                const { result, log: currLog } = korocheLambda(table[x], modPoly, lambdaCoeffs, x, table);
                log += currLog;
                if (result === 0) roots.push(x);
            }
            return { roots, log };
        }

        function displayPolynomialRoots() {
            const polyInput = document.getElementById('poly').value;
            const coefficientsInput = document.getElementById('coefficients').value.split(',').map(Number);
            const fieldSizeInput = parseInt(document.getElementById('fieldSize').value);

            const poly = parseInt(polyInput, 2);
            const mask = (1 << fieldSizeInput) - 1;

            const table = [];
            let value = 1;
            for (let i = 0; i < (1 << fieldSizeInput) - 1; i++) {
                table.push(value);
                value = gfMult(value, 2, poly) & mask;
            }
            table.push(0);

            const lambdaCoeffs = coefficientsInput.map(index => table[index]);
            const { roots, log } = findRoots(table, poly, lambdaCoeffs);

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <h3>Результаты:</h3>
                <pre>${log}</pre>
                <p>Корни многочлена λ(x): ${roots.map(root => `a^${root}`).join(', ')}</p>
            `;
        }
    </script>
</body>
</html>
